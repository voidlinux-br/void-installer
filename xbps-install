#!/usr/bin/env bash
#  - se o comando for `xbps-remove` (remoção), chama `xbps-remove` real
#  - caso contrário, repassa tudo pra xbps-install real

REAL_INSTALL="/usr/bin/xbps-install"
REAL_REMOVE="/usr/bin/xbps-remove"
REAL_QUERY="/usr/bin/xbps-query"

# precisa ser root pra certas ações
if [[ "$EUID" -ne 0 ]]; then
  echo "erro: precisa ser root para executar comandos XBPS" >&2
  exit 1
fi

# Intercepta exatamente "-Scc" para limpar cache inteiro
if [[ "$#" -eq 1 && "$1" == "-Scc" ]]; then
  echo "Limpando cache XBPS por completo..."
  rm -fv /var/cache/xbps/*.xbps
  rm -fv /var/cache/xbps/*.sig*
  exit 0
fi

# Se o primeiro argumento é -R (remoção), repassa pro xbps-remove real
# Ex: xbps-install -R vim
if [[ "$1" == "-R" ]]; then
  exec "$REAL_REMOVE" "$@"
fi

if [[ "$1" == "-Ss" ]]; then
  shift
  exec "$REAL_QUERY" -SsR "$@"
fi

# Se o comando contém "-R" em qualquer posição, também repassa pra remove
for arg in "$@"; do
  if [[ "$arg" == "-R" ]]; then
    exec "$REAL_REMOVE" "$@"
  fi
done

# Caso contrário, usa o xbps-install real
exec "$REAL_INSTALL" "$@"
